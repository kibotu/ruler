jdk:
  - openjdk17
env:
  GRADLE_OPTS: "-Dorg.gradle.daemon=false -Dorg.gradle.parallel=false"
  JITPACK: "true"
before_install:
  # Install NVM and Node.js 16 (compatible with older GLIBC)
  - curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
  - export NVM_DIR="$HOME/.nvm"
  - source "$NVM_DIR/nvm.sh"
  - nvm install 16.13.0
  - nvm use 16.13.0
  - node --version
  - npm --version
  # Install Yarn globally
  - npm install -g yarn@1.22.19
  - yarn --version
  # Configure Gradle to disable offline mode and use system Node.js
  - sed -i 's/org.gradle.offline=true/org.gradle.offline=false/g' gradle.properties
  - echo "" >> gradle.properties
  - echo "# JitPack: Use system Node.js and Yarn" >> gradle.properties
  - echo "kotlin.js.nodejs.download=false" >> gradle.properties
  - echo "kotlin.js.yarn.download=false" >> gradle.properties
install:
  - export NVM_DIR="$HOME/.nvm" && source "$NVM_DIR/nvm.sh" && nvm use 16.13.0 && export PATH="$NVM_DIR/versions/node/v16.13.0/bin:$PATH" && ./gradlew :ruler-models:publishToMavenLocal :ruler-common:publishToMavenLocal :ruler-gradle-plugin:publishToMavenLocal -Pgroup=com.github.kibotu -Pversion=$VERSION --no-daemon
